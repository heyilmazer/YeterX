<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Export Ã–zelliÄŸi</title>
<link rel="stylesheet" href="https://unpkg.com/xp.css/dist/XP.css">
<style>
body{margin:20px;font-family:sans-serif;}
input,textarea,button{display:block;margin-bottom:10px;width:300px;}
textarea{height:80px;}
hr{margin:20px 0;}
ul li{margin-bottom:10px;list-style:none;}
li div{display:flex;flex-direction:column;gap:3px;}
li img{width:80px;height:80px;object-fit:cover;border:1px solid #999;margin:3px;}
.subIconList{margin-left:20px;border-left:1px solid #ccc;padding-left:10px;}
#exportSection{background:#f5f5f5;padding:15px;border-radius:5px;margin:20px 0;}
#jsonOutput{width:100%;height:200px;font-family:monospace;font-size:12px;}
</style>
</head>
<body>
<h1>Admin Panel</h1>

<div id="exportSection">
  <h2>Veri Export/Import</h2>
  <button id="exportBtn">localStorage'dan JSON Ã‡Ä±kar</button>
  <textarea id="jsonOutput" placeholder="JSON verisi burada gÃ¶rÃ¼necek..." readonly></textarea>
  <button id="downloadBtn" style="display:none;">JSON DosyasÄ± Ä°ndir</button>
  
  <hr>
  <h3>JSON Import</h3>
  <input type="file" id="importFile" accept=".json">
  <button id="importBtn">JSON'dan Ä°Ã§e Aktar</button>
</div>

<hr>

<h2>Yeni Ä°kon Ekle</h2>
<input type="text" id="iconTitle" placeholder="BaÅŸlÄ±k">
<input type="file" id="iconFileInput" accept="image/*">
<button id="addIconBtn">Ä°kon Ekle</button>

<hr>
<h2>Mevcut Ä°konlar ve Sub-Iconlar</h2>
<ul id="iconList"></ul>

<div id="iconEditor" style="display:none;margin-top:20px;">
  <h3 id="editorTitle"></h3>

  <h4>Yeni Sub-Icon Ekle (Opsiyonel)</h4>
  <input type="text" id="subIconTitle" placeholder="Sub-Icon BaÅŸlÄ±ÄŸÄ±">
  <input type="file" id="subIconFileInput" accept="image/*">
  <button id="addSubIconBtn">Sub-Icon Ekle</button>

  <h4>Yeni Post Ekle</h4>
  <input type="text" id="postTitle" placeholder="Post BaÅŸlÄ±ÄŸÄ± (opsiyonel)">
  <textarea id="postContent" placeholder="Post Ä°Ã§eriÄŸi (opsiyonel)"></textarea>
  <input type="text" id="postUrl" placeholder="URL (opsiyonel)">
  <input type="text" id="postMedia" placeholder="YouTube/Medya Linki (opsiyonel)">
  <input type="file" id="postFilesInput" multiple accept="image/*">
  <button id="addPostBtn">Post Ekle</button>

  <h4>Var Olan Postlar</h4>
  <ul id="postList"></ul>
</div>

<script>
let icons = JSON.parse(localStorage.getItem('icons')||'[]');
const iconListEl=document.getElementById('iconList');
const iconEditor=document.getElementById('iconEditor');
const editorTitle=document.getElementById('editorTitle');
const postListEl=document.getElementById('postList');
let selectedIconIndex=null;
let selectedSubIconIndex=null;

function saveIcons(){ localStorage.setItem('icons',JSON.stringify(icons)); }

// Export/Import FonksiyonlarÄ±
document.getElementById('exportBtn').addEventListener('click', function() {
  const iconsData = localStorage.getItem('icons') || '[]';
  const jsonOutput = document.getElementById('jsonOutput');
  
  // JSON'u gÃ¼zel formatlayarak gÃ¶ster
  const formatted = JSON.stringify(JSON.parse(iconsData), null, 2);
  jsonOutput.value = formatted;
  
  document.getElementById('downloadBtn').style.display = 'block';
});

document.getElementById('downloadBtn').addEventListener('click', function() {
  const jsonData = document.getElementById('jsonOutput').value;
  const blob = new Blob([jsonData], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'icons-data.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});

document.getElementById('importBtn').addEventListener('click', function() {
  const fileInput = document.getElementById('importFile');
  const file = fileInput.files[0];
  
  if (!file) {
    alert('LÃ¼tfen bir JSON dosyasÄ± seÃ§in!');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedData = JSON.parse(e.target.result);
      icons = importedData;
      saveIcons();
      renderIcons();
      alert('Veriler baÅŸarÄ±yla iÃ§e aktarÄ±ldÄ±!');
    } catch (error) {
      alert('GeÃ§ersiz JSON dosyasÄ±!');
    }
  };
  reader.readAsText(file);
});

function renderIcons(){
  iconListEl.innerHTML='';
  icons.forEach((icon,index)=>{
    const li=document.createElement('li');
    li.innerHTML=`<strong>${icon.title}</strong> 
      <button onclick="editIcon(${index})">DÃ¼zenle</button>
      <button onclick="deleteIcon(${index})">Sil</button>`;
    if(icon.subIcons && icon.subIcons.length>0){
      const subUl=document.createElement('ul'); subUl.className='subIconList';
      icon.subIcons.forEach((sub,i)=>{
        const subLi=document.createElement('li');
        subLi.innerHTML=`<strong>${sub.title}</strong>
          <button onclick="editSubIcon(${index},${i})">DÃ¼zenle</button>
          <button onclick="deleteSubIcon(${index},${i})">Sil</button>`;
        subUl.appendChild(subLi);
      });
      li.appendChild(subUl);
    }
    iconListEl.appendChild(li);
  });
}

function editIcon(index){
  selectedIconIndex=index; selectedSubIconIndex=null;
  iconEditor.style.display='block';
  editorTitle.textContent=`Ä°kon DÃ¼zenle: ${icons[index].title}`;
  renderPosts();
}
function editSubIcon(iconIndex,subIndex){
  selectedIconIndex=iconIndex; selectedSubIconIndex=subIndex;
  iconEditor.style.display='block';
  editorTitle.textContent=`Sub-Icon DÃ¼zenle: ${icons[iconIndex].subIcons[subIndex].title}`;
  renderPosts();
}
function deleteIcon(index){
  if(confirm("Silmek istediÄŸine emin misin?")){
    icons.splice(index,1); saveIcons(); renderIcons(); iconEditor.style.display='none';
  }
}
function deleteSubIcon(iconIndex,subIndex){
  if(confirm("Silmek istediÄŸine emin misin?")){
    icons[iconIndex].subIcons.splice(subIndex,1); saveIcons(); renderIcons(); iconEditor.style.display='none';
  }
}

function renderPosts(){
  postListEl.innerHTML='';
  if(selectedIconIndex===null) return;
  const obj= selectedSubIconIndex!==null ? icons[selectedIconIndex].subIcons[selectedSubIconIndex] : icons[selectedIconIndex];
  const posts=obj.posts||[];
  posts.forEach((post,idx)=>{
    const li=document.createElement('li');
    let imagesHTML='';
    if(post.images && post.images.length>0){
      post.images.forEach(img=>{
        imagesHTML+=`<img src="${img}" alt="Post GÃ¶rsel">`;
      });
    }
    li.innerHTML=`${imagesHTML}<div><strong>${post.title||''}</strong><p>${post.content||''}</p>
                  ${post.url? `<a href="${post.url}" target="_blank">${post.url}</a>`:''}
                  ${post.media? `<p>ðŸŽ¬ Medya: ${post.media}</p>`:''}
                  </div>
                  <button onclick="deletePost(${idx})">Sil</button>`;
    postListEl.appendChild(li);
  });
}

// --- Yeni ikon ekleme ---
document.getElementById('addIconBtn').addEventListener('click',()=>{
  const title=document.getElementById('iconTitle').value.trim();
  const fileInput=document.getElementById('iconFileInput');
  if(!title || fileInput.files.length===0){ alert("BaÅŸlÄ±k ve gÃ¶rsel gerekli!"); return; }
  const file=fileInput.files[0];
  const path=`icons/${file.name}`;
  icons.push({id:file.name.split('.')[0].toLowerCase(), title, image:path, posts:[], subIcons:[]});
  saveIcons(); renderIcons();
  document.getElementById('iconTitle').value=''; fileInput.value='';
});

// --- Yeni sub-icon ekleme ---
document.getElementById('addSubIconBtn').addEventListener('click',()=>{
  if(selectedIconIndex===null){ alert("Ã–nce ikon seÃ§"); return; }
  const title=document.getElementById('subIconTitle').value.trim();
  const fileInput=document.getElementById('subIconFileInput');
  if(!title || fileInput.files.length===0){ alert("BaÅŸlÄ±k ve gÃ¶rsel gerekli!"); return; }
  const file=fileInput.files[0];
  const path=`icons/${file.name}`;
  icons[selectedIconIndex].subIcons.push({id:file.name.split('.')[0].toLowerCase(), title, image:path, posts:[], subIcons:[]});
  saveIcons(); renderIcons();
  document.getElementById('subIconTitle').value=''; fileInput.value='';
});

// --- Yeni post ekleme ---
document.getElementById('addPostBtn').addEventListener('click',()=>{
  if(selectedIconIndex===null) return;
  const obj= selectedSubIconIndex!==null ? icons[selectedIconIndex].subIcons[selectedSubIconIndex] : icons[selectedIconIndex];
  const title=document.getElementById('postTitle').value.trim();
  const content=document.getElementById('postContent').value.trim();
  const url=document.getElementById('postUrl').value.trim();
  const media=document.getElementById('postMedia').value.trim();
  const fileInput=document.getElementById('postFilesInput');
  let images=[];
  for(let i=0;i<fileInput.files.length;i++){
    images.push(`posts/${fileInput.files[i].name}`);
  }
  obj.posts.push({title, content, url, media, images});
  saveIcons(); renderPosts();
  document.getElementById('postTitle').value=''; 
  document.getElementById('postContent').value='';
  document.getElementById('postUrl').value='';
  document.getElementById('postMedia').value='';
  fileInput.value='';
});

// Global fonksiyonlar
window.deleteIcon=deleteIcon;
window.editIcon=editIcon;
window.editSubIcon=editSubIcon;
window.deleteSubIcon=deleteSubIcon;
window.deletePost=(idx)=>{
  const obj= selectedSubIconIndex!==null ? icons[selectedIconIndex].subIcons[selectedSubIconIndex] : icons[selectedIconIndex];
  if(confirm("Silmek istediÄŸine emin misin?")){
    obj.posts.splice(idx,1); saveIcons(); renderPosts();
  }
};

renderIcons();
</script>
</body>
</html>